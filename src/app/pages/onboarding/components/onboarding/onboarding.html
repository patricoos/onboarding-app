<div class="flex gap-x-4">
    <div class="w-1/5 bg-white p-4">
        <h2 class="text-xl font-semibold mb-4">Onboarding</h2>
        <p-tree [value]="nodes" selectionMode="single" [(selection)]="selectedNode" [contextMenu]="menu" class="min-h-[50vh]"></p-tree>

        <p-button *ngIf="editMode" label="Add" icon="pi pi-plus" (click)="showAddDialog()" class="mb-2" />

        <p-contextMenu #menu [model]="contextMenuItems"></p-contextMenu>

        <p-dialog header="{{ editingNode ? 'Edit Node' : 'Add Node' }}" [(visible)]="dialogVisible" [modal]="true" [closable]="false">
            <input pInputText [(ngModel)]="labelInput" type="text" placeholder="Label" class="p-inputtext w-full mb-3" />
            <div class="text-right">
                <p-button pButton label="Save" (click)="saveNode()" class="p-button-sm p-button-primary mr-2" />
                <p-button pButton label="Cancel" (click)="dialogVisible=false" class="p-button-sm p-button-secondary" />
            </div>
        </p-dialog>
    </div>

    <div class="w-4/5 bg-white p-6">
        <ng-container *ngIf="selectedNode?.data">
            <h1 class="text-2xl font-bold mb-4">{{selectedNode.label}}</h1>
            <p-editor [readonly]="!editMode" [(ngModel)]="selectedNode.data!.text" (ngModelChange)="updateNode()" />

            <ng-container *ngIf="selectedNode?.data?.files || editMode">
                <h4 class="text-xl font-semibold mb-4">Files</h4>

                <p-fileUpload #uploader *ngIf="editMode" name="file" [customUpload]="true" mode="basic" chooseIcon="pi pi-upload" [auto]="true" (uploadHandler)="upload($event, uploader)"></p-fileUpload>

                <p-table [value]="selectedNode.data!.files" editable="true">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Name</th>
                            <th>Link</th>
                            <th>Actions</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-file let-editing="editing">
                        <tr>
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input pInputText [(ngModel)]="file.name" />
                                    </ng-template>
                                    <ng-template pTemplate="output">{{ file.name }}</ng-template>
                                </p-cellEditor>
                            </td>
                            <td><a [href]="file.url" target="_blank">Download</a></td>
                            <td>
                                <button pButton icon="pi pi-trash" (click)="delete(file)" severity="danger"></button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </ng-container>
            <ng-container *ngIf="selectedNode?.data?.questions || editMode">
                <h4 class="text-xl font-semibold mb-4">Questions</h4>

                <app-questions [selectedNode]="selectedNode" [editMode]="editMode" (save)="updateNode()"/>
        </ng-container>

          <ng-container *ngIf="selectedNode?.data?.qa || editMode">
                <h4 class="text-xl font-semibold mb-4">Questions and Answers</h4>

                <app-questions-and-answers [selectedNode]="selectedNode"  [editMode]="editMode"  (save)="updateNode()"/>
        </ng-container>
        </ng-container>
    </div>
</div>
